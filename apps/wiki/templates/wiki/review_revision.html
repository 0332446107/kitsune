{# vim: set ts=2 et sts=2 sw=2: #}
{% extends "wiki/base.html" %}
{% from "wiki/includes/sidebar_modules.html" import document_tabs %}
{% set title = _('Review Revision {id} | {document}')|f(document=document.title, id=revision.id) %}
{% set crumbs = [(url('wiki.category', document.category), document.get_category_display()),
                 (document.get_absolute_url(), document.title)] %}
{% set classes = 'review' %}

{% block content %}
  <article id="review-revision" class="main">
    <div id="breadcrumbs">
      {{ _('You are here:') }}
      {{ breadcrumbs(crumbs) }}
    </div>

    <h1>{{ _('Review Revision of {title}')|f(title=document.title) }}</h1>
    <p>{{ _('Reviewing Revision {id} by {user}')|f(id=revision.id, user=revision.creator) }}.
    <a href="{{ url('wiki.document_revisions', document.slug) }}">{{ _('Back to History') }}</a></p>

    {% if revision.reviewed %}
      <p>
        {{ _('This revision was already reviewed by {user} on {date}.')|f(user=revision.reviewer, date=datetimeformat(revision.reviewed, format='longdatetime'))|safe }}
      </p>
    {% elif document.current_revision %}
      {% with revision_from = document.current_revision, revision_to = revision, revision_from_header = _('Current Public Revision'), revision_to_header = _('Submitted Revision') %}
        {% include 'wiki/includes/revision_diff.html' %}
      {% endwith %}
    {% else %}
      <p>{{ _('This document does not have a current revision.') }}</p>
      <h3>{{ _('Revision source:') }}</h3>
      <div id="revision-content">
        <pre>{{ revision.content }}</pre>
      </div>
      <h3>{{ _('Revision rendered html:') }}</h3>
      <div id="revision-html">
        {{ revision.content_parsed|safe }}
      </div>
    {% endif %}

    {# TODO: diff? the summary and keywords #}

    {% include 'wiki/includes/review_form.html' %}
  </article>
{% endblock %}

{% block side %}
  {{ document_tabs(document, document.parent, user, '', settings) }}
{% endblock %}